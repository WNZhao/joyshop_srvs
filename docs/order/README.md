# è®¢å•æœåŠ¡æ–‡æ¡£

## æ–‡æ¡£æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«äº†è®¢å•æœåŠ¡çš„è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ï¼Œæ¶µç›–äº†è®¢å•æ‰¹é‡å¤„ç†æ¶æ„ã€åˆ†å¸ƒå¼é”æœºåˆ¶å’Œè·¨æœåŠ¡è°ƒç”¨ä¼˜åŒ–ç­‰æ ¸å¿ƒæŠ€æœ¯å®ç°ã€‚

## æ–‡æ¡£ç»“æ„

### ğŸ“‹ [ä¸šåŠ¡é€»è¾‘æ¦‚è¿°æ–‡æ¡£](./business-logic-overview.md)
å…¨é¢ä»‹ç»è®¢å•æœåŠ¡çš„ä¸šåŠ¡é€»è¾‘è®¾è®¡å’Œå¤„ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼š
- æ ¸å¿ƒä¸šåŠ¡æµç¨‹å’Œæ•°æ®æ¨¡å‹å…³ç³»
- æ‰¹é‡å¤„ç†vså•æ¡å¤„ç†çš„é€‰æ‹©åŸåˆ™å’Œå¯¹æ¯”åˆ†æ
- å„ä¸ªæ¥å£çš„ä¸šåŠ¡åœºæ™¯å’Œå®ç°æ–¹å¼
- æ€§èƒ½ä¼˜åŒ–è®¾è®¡å’Œé”™è¯¯å¤„ç†æœºåˆ¶

**æ ¸å¿ƒinsights**ï¼š
- ğŸ¯ è®¢å•åˆ›å»ºé‡‡ç”¨æ‰¹é‡å¤„ç†ï¼ˆä¸€æ¬¡å¤„ç†å¤šä¸ªå•†å“ï¼‰
- ğŸ“ è®¢å•æ›´æ–°é‡‡ç”¨å•æ¡å¤„ç†ï¼ˆé’ˆå¯¹ç‰¹å®šè®¢å•çŠ¶æ€å˜æ›´ï¼‰
- ğŸ” ä¸šåŠ¡åœºæ™¯å†³å®šå¤„ç†æ–¹å¼é€‰æ‹©
- ğŸ“Š å®Œæ•´çš„æ€§èƒ½æ•°æ®å¯¹æ¯”åˆ†æ

### ğŸ“– [æ‰¹é‡å¤„ç†æ¶æ„æ–‡æ¡£](./batch-processing-architecture.md)
è¯¦ç»†è¯´æ˜äº†è®¢å•åˆ›å»ºçš„æ‰¹é‡å¤„ç†æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š
- æ•´ä½“æ¶æ„è®¾è®¡å’Œæ‰§è¡Œæµç¨‹
- åˆ†å¸ƒå¼é”ã€è·¨æœåŠ¡è°ƒç”¨ã€æ‰¹é‡æ’å…¥çš„ååŒå·¥ä½œ
- æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- æ‰¹é‡vså•æ¡å¤„ç†çš„é€‰æ‹©åŸåˆ™

**å…³é”®ç‰¹æ€§**ï¼š
- ğŸ”’ Redisåˆ†å¸ƒå¼é”é˜²é‡å¤æäº¤
- âš¡ æ‰¹é‡æ’å…¥æå‡æ•°æ®åº“æ€§èƒ½
- ğŸŒ è·¨æœåŠ¡æ‰¹é‡è°ƒç”¨å‡å°‘ç½‘ç»œå¼€é”€
- ğŸ”„ å®Œå–„çš„äº‹åŠ¡å›æ»šæœºåˆ¶

### ğŸ” [åˆ†å¸ƒå¼é”æœºåˆ¶æ–‡æ¡£](./distributed-lock-mechanism.md)
æ·±å…¥ä»‹ç»äº†åŸºäºRedisçš„åˆ†å¸ƒå¼é”å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- ä¸‰ç§ä¸šåŠ¡åœºæ™¯çš„é”è®¾è®¡ï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰
- é”çš„å®ç°åŸç†å’Œé…ç½®å‚æ•°è¯¦è§£
- å¼‚å¸¸å¤„ç†å’Œç›‘æ§å‘Šè­¦æœºåˆ¶
- æ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœæ’æŸ¥æŒ‡å—

**åº”ç”¨åœºæ™¯**ï¼š
- è®¢å•åˆ›å»ºé˜²é‡å¤æäº¤ï¼š30ç§’é”å®š
- è®¢å•çŠ¶æ€æ›´æ–°é˜²å¹¶å‘ï¼š10ç§’é”å®š
- è®¢å•åˆ é™¤é˜²å†²çªï¼š15ç§’é”å®š

### ğŸŒ‰ [è·¨æœåŠ¡è°ƒç”¨ä¼˜åŒ–æ–‡æ¡£](./cross-service-optimization.md)
è¯¦ç»†é˜è¿°äº†å¾®æœåŠ¡é—´è°ƒç”¨çš„ä¼˜åŒ–å®è·µï¼ŒåŒ…æ‹¬ï¼š
- æ‰¹é‡æ¥å£è®¾è®¡å’Œå®ç°ç­–ç•¥
- æ€§èƒ½ä¼˜åŒ–ï¼ˆè¿æ¥æ± ã€è¶…æ—¶æ§åˆ¶ã€æ‰¹é‡å¤„ç†ï¼‰
- å®¹é”™æœºåˆ¶ï¼ˆé‡è¯•ã€ç†”æ–­ã€é™çº§ï¼‰
- ç›‘æ§å‘Šè­¦å’Œæ•…éšœæ’æŸ¥

**ä¼˜åŒ–æˆæœ**ï¼š
- ğŸš€ æ‰¹é‡è°ƒç”¨å‡å°‘50%+ç½‘ç»œè¯·æ±‚
- ğŸ¯ æ™ºèƒ½é‡è¯•æå‡å¯ç”¨æ€§
- ğŸ“Š å…¨é¢ç›‘æ§ç¡®ä¿æœåŠ¡è´¨é‡
- ğŸ›¡ï¸ ç†”æ–­æœºåˆ¶ä¿æŠ¤ç³»ç»Ÿç¨³å®š

## æŠ€æœ¯æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        A[Webå‰ç«¯] --> B[ç§»åŠ¨ç«¯APP]
    end
    
    subgraph "ç½‘å…³å±‚"
        C[API Gateway]
    end
    
    subgraph "æœåŠ¡å±‚"
        D[è®¢å•æœåŠ¡<br/>Order Service]
        E[å•†å“æœåŠ¡<br/>Goods Service]
        F[åº“å­˜æœåŠ¡<br/>Inventory Service]
        G[ç”¨æˆ·æœåŠ¡<br/>User Service]
    end
    
    subgraph "æ•°æ®å±‚"
        H[(MySQL<br/>è®¢å•æ•°æ®)]
        I[(Redis<br/>åˆ†å¸ƒå¼é”/ç¼“å­˜)]
        J[(MySQL<br/>å•†å“æ•°æ®)]
        K[(MySQL<br/>åº“å­˜æ•°æ®)]
    end
    
    A --> C
    B --> C
    C --> D
    
    D --> E
    D --> F
    D --> G
    
    D --> H
    D --> I
    E --> J
    F --> K
    G --> H
```

## æ ¸å¿ƒæµç¨‹å›¾

### è®¢å•åˆ›å»ºå®Œæ•´æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant O as è®¢å•æœåŠ¡
    participant L as åˆ†å¸ƒå¼é”
    participant G as å•†å“æœåŠ¡
    participant I as åº“å­˜æœåŠ¡
    participant DB as æ•°æ®åº“
    
    U->>O: æäº¤è®¢å•
    O->>L: è·å–ç”¨æˆ·é”
    L-->>O: é”è·å–æˆåŠŸ
    
    O->>DB: å¼€å¯äº‹åŠ¡
    O->>G: æ‰¹é‡è·å–å•†å“ä¿¡æ¯
    G-->>O: è¿”å›å•†å“è¯¦æƒ…
    
    O->>O: éªŒè¯å•†å“å¯ç”¨æ€§
    O->>I: æ‰¹é‡æ‰£å‡åº“å­˜
    I-->>O: åº“å­˜æ‰£å‡æˆåŠŸ
    
    O->>DB: æ‰¹é‡æ’å…¥è®¢å•å•†å“
    O->>DB: æäº¤äº‹åŠ¡
    O->>L: é‡Šæ”¾é”
    
    O-->>U: è®¢å•åˆ›å»ºæˆåŠŸ
    
    Note over O,I: å¼‚å¸¸æƒ…å†µå¤„ç†
    O->>I: å›æ»šåº“å­˜
    O->>DB: å›æ»šäº‹åŠ¡
    O->>L: é‡Šæ”¾é”
```

## æ€§èƒ½æ•°æ®

### ä¼˜åŒ–å‰åå¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|----------|
| è®¢å•åˆ›å»ºå“åº”æ—¶é—´ | ~2000ms | ~800ms | 60%â†“ |
| æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° | N+3 | 3 | 70%â†“ |
| ç½‘ç»œè°ƒç”¨æ¬¡æ•° | N+2 | 2 | 75%â†“ |
| å¹¶å‘å¤„ç†èƒ½åŠ› | 100 TPS | 300 TPS | 200%â†‘ |

### ç³»ç»Ÿå®¹é‡è§„åˆ’

- **å•å®ä¾‹å¤„ç†èƒ½åŠ›**: 300 TPS
- **å»ºè®®éƒ¨ç½²å®ä¾‹æ•°**: 3-5ä¸ªï¼ˆæ”¯æŒ1500 TPSï¼‰
- **æ•°æ®åº“è¿æ¥æ± **: 50-100ä¸ªè¿æ¥
- **Redisè¿æ¥æ± **: 20-30ä¸ªè¿æ¥

## ç›‘æ§æŒ‡æ ‡

### æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡
- ğŸ“ˆ è®¢å•åˆ›å»ºæˆåŠŸç‡ï¼š>99.5%
- â±ï¸ å¹³å‡å“åº”æ—¶é—´ï¼š<1ç§’
- ğŸ”„ é‡è¯•æˆåŠŸç‡ï¼š>95%
- ğŸ”’ é”è·å–æˆåŠŸç‡ï¼š>99%

### æŠ€æœ¯æŒ‡æ ‡
- ğŸ’¾ æ•°æ®åº“è¿æ¥ä½¿ç”¨ç‡ï¼š<80%
- ğŸŒ è·¨æœåŠ¡è°ƒç”¨å»¶è¿Ÿï¼šP99<2ç§’
- ğŸ“Š æ‰¹é‡å¤„ç†å¹³å‡å¤§å°ï¼š15-20ä¸ªå•†å“
- ğŸš¨ é”™è¯¯ç‡ï¼š<0.5%

## éƒ¨ç½²å»ºè®®

### ç¯å¢ƒé…ç½®
```yaml
# ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®
order_service:
  replicas: 3
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  
redis:
  cluster_mode: true
  replicas: 3
  memory: 8Gi
  
mysql:
  max_connections: 500
  innodb_buffer_pool_size: 8G
```

### æ‰©å®¹ç­–ç•¥
1. **å‚ç›´æ‰©å®¹**: å¢åŠ å•ä¸ªå®ä¾‹çš„èµ„æºé…ç½®
2. **æ°´å¹³æ‰©å®¹**: å¢åŠ æœåŠ¡å®ä¾‹æ•°é‡
3. **æ•°æ®åº“ä¼˜åŒ–**: è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨
4. **ç¼“å­˜ä¼˜åŒ–**: å¢åŠ Redisé›†ç¾¤èŠ‚ç‚¹

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d redis mysql

# å¯åŠ¨å•†å“æœåŠ¡
cd goods_srv && go run main.go

# å¯åŠ¨åº“å­˜æœåŠ¡  
cd inventory_srv && go run main.go

# å¯åŠ¨è®¢å•æœåŠ¡
cd order_srv && go run main.go
```

### 2. æ¥å£æµ‹è¯•
```bash
# åˆ›å»ºè®¢å•
curl -X POST http://localhost:8080/v1/orders \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 12345,
    "address": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "name": "å¼ ä¸‰",
    "mobile": "13800138000"
  }'
```

### 3. ç›‘æ§æŸ¥çœ‹
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000
- æ—¥å¿—æŸ¥çœ‹: `docker logs order_srv`

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè®¢å•åˆ›å»ºç”¨æ‰¹é‡å¤„ç†ï¼Œè€Œè®¢å•æ›´æ–°ç”¨å•æ¡å¤„ç†ï¼Ÿ
A: **ä¸šåŠ¡åœºæ™¯å†³å®šå¤„ç†æ–¹å¼**ï¼š
- **è®¢å•åˆ›å»º**ï¼šä¸€æ¬¡æ€§å¤„ç†è´­ç‰©è½¦ä¸­çš„å¤šä¸ªå•†å“ï¼Œéœ€è¦æ‰¹é‡æ’å…¥è®¢å•å•†å“è®°å½•ï¼Œæ‰¹é‡å¤„ç†å¯å‡å°‘50%+çš„ç½‘ç»œè°ƒç”¨å’Œæ•°æ®åº“æ“ä½œ
- **è®¢å•æ›´æ–°**ï¼šé€šå¸¸æ˜¯æ”¯ä»˜å›è°ƒæˆ–çŠ¶æ€å˜æ›´ï¼Œé’ˆå¯¹ç‰¹å®šè®¢å•çš„å•ä¸€æ“ä½œï¼Œå•æ¡å¤„ç†å·²æ»¡è¶³æ€§èƒ½éœ€æ±‚ä¸”æ›´ç²¾ç¡®å®‰å…¨

### Q: æ‰¹é‡å¤„ç†çš„æ€§èƒ½æå‡æœ‰å¤šå¤§ï¼Ÿ
A: æ ¹æ®å®é™…æµ‹è¯•æ•°æ®ï¼š
- è®¢å•åˆ›å»ºå“åº”æ—¶é—´ä»2000msé™è‡³800msï¼ˆæå‡60%ï¼‰
- æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ä»N+3æ¬¡é™è‡³3æ¬¡ï¼ˆå‡å°‘70%ï¼‰  
- ç½‘ç»œè°ƒç”¨æ¬¡æ•°ä»N+2æ¬¡é™è‡³2æ¬¡ï¼ˆå‡å°‘75%ï¼‰
- å¹¶å‘å¤„ç†èƒ½åŠ›ä»100 TPSæå‡è‡³300 TPSï¼ˆæå‡200%ï¼‰

### Q: ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ
A: é˜²æ­¢ç”¨æˆ·é‡å¤æäº¤è®¢å•ï¼Œç¡®ä¿åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç”¨æˆ·çº§åˆ«çš„é”ç²’åº¦æ—¢ä¿è¯äº†å®‰å…¨æ€§ï¼Œåˆä¸å½±å“å…¶ä»–ç”¨æˆ·çš„æ“ä½œã€‚è®¢å•åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤éƒ½é‡‡ç”¨äº†ä¸åŒç²’åº¦çš„åˆ†å¸ƒå¼é”ä¿æŠ¤ã€‚

### Q: æ‰¹é‡å¤„ç†çš„æ‰¹é‡å¤§å°å¦‚ä½•ç¡®å®šï¼Ÿ
A: ç›®å‰è®¾ç½®ä¸º100ï¼Œè¿™æ˜¯åŸºäºå†…å­˜ä½¿ç”¨ã€ç½‘ç»œä¼ è¾“å’Œæ•°æ®åº“æ€§èƒ½çš„å¹³è¡¡ç‚¹ã€‚å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯å’Œæ€§èƒ½æµ‹è¯•ç»“æœè¿›è¡Œè°ƒæ•´ã€‚

### Q: è·¨æœåŠ¡è°ƒç”¨å¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ
A: å®ç°äº†å®Œæ•´çš„é‡è¯•å’Œå›æ»šæœºåˆ¶ã€‚å•†å“æœåŠ¡è°ƒç”¨å¤±è´¥ä¼šå›æ»šäº‹åŠ¡ï¼Œåº“å­˜æ‰£å‡å¤±è´¥ä¼šè‡ªåŠ¨å›æ»šå·²æ‰£å‡çš„åº“å­˜ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚

### Q: å¦‚ä½•ç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼Ÿ
A: é€šè¿‡Prometheusæ”¶é›†æŒ‡æ ‡ï¼ŒGrafanaå±•ç¤ºä»ªè¡¨æ¿ï¼Œå…³é”®æŒ‡æ ‡åŒ…æ‹¬å“åº”æ—¶é—´ã€æˆåŠŸç‡ã€é”™è¯¯ç‡ç­‰ã€‚è®¾ç½®äº†åˆç†çš„å‘Šè­¦é˜ˆå€¼ã€‚

## è´¡çŒ®æŒ‡å—

1. **ä»£ç è§„èŒƒ**: éµå¾ªGoå®˜æ–¹ä»£ç è§„èŒƒ
2. **æµ‹è¯•è¦†ç›–**: æ–°å¢åŠŸèƒ½éœ€è¦åŒ…å«å•å…ƒæµ‹è¯•
3. **æ–‡æ¡£æ›´æ–°**: é‡è¦å˜æ›´éœ€è¦æ›´æ–°ç›¸åº”æ–‡æ¡£
4. **æ€§èƒ½æµ‹è¯•**: æ€§èƒ½ç›¸å…³ä¿®æ”¹éœ€è¦è¿›è¡Œå‹æµ‹éªŒè¯

## ç›¸å…³é“¾æ¥

- [é¡¹ç›®ä¸»é¡µ](../../README.md)
- [APIæ–‡æ¡£](../api/order-api.md)
- [éƒ¨ç½²æŒ‡å—](../deployment/order-deployment.md)
- [æ€§èƒ½æµ‹è¯•æŠ¥å‘Š](../performance/order-benchmark.md)

---

ğŸ’¡ **æç¤º**: è¿™äº›æ–‡æ¡£åŸºäºå½“å‰çš„ä»£ç å®ç°ï¼Œå¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚