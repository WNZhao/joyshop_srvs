# JoyShop 微服务测试用例文档

## 📖 概述

本文档提供了 JoyShop 微服务系统的完整测试用例，涵盖用户服务、商品服务、库存服务和订单服务的功能测试、集成测试和性能测试场景。

## 🗂️ 测试数据概览

### 测试环境数据统计
- **用户数量**: 15人（1管理员 + 12普通用户 + 2VIP用户）
- **商品数量**: 20+个真实商品
- **库存记录**: 40+条库存数据
- **订单数量**: 10个订单（涵盖各种状态）
- **购物车记录**: 15+条购物车数据

## 🧪 测试用例分类

### 1. 用户服务 (user_srv) 测试用例

#### 1.1 用户认证测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| USER_001 | 管理员登录 | 用户名: admin, 密码: 123456 | 登录成功，获取管理员权限 |
| USER_002 | 普通用户登录 | 用户名: zhangsan, 密码: 123456 | 登录成功，获取普通用户权限 |
| USER_003 | VIP用户登录 | 用户名: vip_user, 密码: 123456 | 登录成功，获取VIP用户权限 |
| USER_004 | 错误密码登录 | 用户名: zhangsan, 密码: wrongpassword | 登录失败，返回密码错误 |
| USER_005 | 不存在用户登录 | 用户名: nonexist, 密码: 123456 | 登录失败，返回用户不存在 |

#### 1.2 用户信息管理测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| USER_006 | 用户信息查询 | 用户ID: 2 | 返回张三的详细信息 |
| USER_007 | 用户列表查询（分页） | page: 1, pageSize: 5 | 返回5个用户的列表 |
| USER_008 | 用户信息更新 | 更新用户昵称 | 用户信息更新成功 |
| USER_009 | 用户注册 | 新用户信息 | 用户注册成功，生成新ID |

### 2. 商品服务 (goods_srv) 测试用例

#### 2.1 商品查询测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| GOODS_001 | 商品详情查询 | 商品ID: 1 (iPhone 15 Pro Max) | 返回完整商品信息 |
| GOODS_002 | 商品列表查询 | 分页参数 page: 1, pageSize: 10 | 返回10个商品列表 |
| GOODS_003 | 热销商品查询 | is_hot: true | 返回热销商品列表 |
| GOODS_004 | 分类商品查询 | 分类ID: 1 (电子数码) | 返回该分类下所有商品 |
| GOODS_005 | 品牌商品查询 | 品牌ID: 1 (Apple) | 返回Apple品牌商品 |

#### 2.2 商品搜索测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| GOODS_006 | 关键词搜索 | 关键词: "iPhone" | 返回包含iPhone的商品 |
| GOODS_007 | 价格区间搜索 | 价格范围: 1000-10000 | 返回价格在范围内的商品 |
| GOODS_008 | 综合搜索 | 品牌+价格+关键词 | 返回符合条件的商品 |

#### 2.3 分类管理测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| GOODS_009 | 分类树查询 | 查询完整分类树 | 返回3级分类结构 |
| GOODS_010 | 子分类查询 | 父分类ID: 1 | 返回该分类的子分类 |

### 3. 库存服务 (inventory_srv) 测试用例

#### 3.1 库存查询测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| INV_001 | 单商品库存查询 | 商品ID: 1 | 返回iPhone库存156件 |
| INV_002 | 批量库存查询 | 商品ID列表: [1,2,3] | 返回多个商品库存信息 |
| INV_003 | 低库存预警查询 | 库存阈值: 10 | 返回库存不足的商品列表 |
| INV_004 | 零库存商品查询 | 库存: 0 | 返回已售罄商品 |

#### 3.2 库存操作测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| INV_005 | 库存扣减（正常） | 商品ID: 1, 扣减数量: 2 | 库存从156减为154，返回成功 |
| INV_006 | 库存扣减（库存不足） | 商品ID: 5, 扣减数量: 100 | 扣减失败，返回库存不足 |
| INV_007 | 库存回滚 | 商品ID: 1, 回滚数量: 2 | 库存恢复，返回成功 |
| INV_008 | 并发库存扣减 | 10个并发请求扣减同一商品 | 使用乐观锁防止超卖 |

#### 3.3 库存批量操作测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| INV_009 | 批量库存扣减 | 多个商品及数量 | 所有库存扣减成功或全部失败 |
| INV_010 | 批量库存回滚 | 订单取消回滚 | 相关库存全部恢复 |

### 4. 订单服务 (order_srv) 测试用例

#### 4.1 购物车测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| CART_001 | 添加商品到购物车 | 用户ID: 2, 商品ID: 1, 数量: 1 | 购物车添加成功 |
| CART_002 | 查询用户购物车 | 用户ID: 2 | 返回用户所有购物车商品 |
| CART_003 | 更新购物车商品数量 | 商品数量: 3 | 购物车数量更新成功 |
| CART_004 | 删除购物车商品 | 购物车项ID | 商品从购物车移除 |
| CART_005 | 选中/取消商品 | 设置选中状态 | 商品选中状态更新 |

#### 4.2 订单创建测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| ORDER_001 | 单商品下单 | 用户ID: 2, 商品ID: 1, 数量: 1 | 订单创建成功，生成订单号 |
| ORDER_002 | 购物车批量下单 | 用户ID: 2, 选中的购物车商品 | 订单创建成功，包含多个商品 |
| ORDER_003 | 库存不足下单 | 商品库存不足 | 下单失败，返回库存不足 |
| ORDER_004 | 大额订单创建 | VIP用户大额订单 | 订单创建成功，触发VIP服务 |

#### 4.3 订单状态管理测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| ORDER_005 | 订单支付 | 订单ID, 支付方式 | 订单状态变为支付成功 |
| ORDER_006 | 订单发货 | 订单ID, 物流信息 | 订单状态变为已发货 |
| ORDER_007 | 订单完成 | 订单ID | 订单状态变为交易完成 |
| ORDER_008 | 订单取消 | 未支付订单ID | 订单取消，库存回滚 |

#### 4.4 订单查询测试
| 用例ID | 测试场景 | 测试数据 | 预期结果 |
|--------|----------|----------|----------|
| ORDER_009 | 用户订单列表 | 用户ID: 2 | 返回用户所有订单 |
| ORDER_010 | 订单详情查询 | 订单ID: 1 | 返回订单详细信息 |
| ORDER_011 | 订单状态筛选 | 状态: TRADE_SUCCESS | 返回支付成功的订单 |

## 🔄 集成测试场景

### 5.1 完整购物流程测试
| 场景ID | 测试流程 | 涉及服务 | 验证点 |
|--------|----------|----------|---------|
| INT_001 | 用户浏览→加购物车→下单→支付 | 全部服务 | 数据一致性，库存同步 |
| INT_002 | 多用户并发下单同一商品 | 订单+库存 | 防止超卖，库存准确性 |
| INT_003 | 订单取消库存回滚 | 订单+库存 | 库存正确回滚 |
| INT_004 | VIP用户专享服务 | 用户+订单 | VIP权益正确执行 |

### 5.2 异常情况测试
| 场景ID | 异常情况 | 测试目标 | 预期处理 |
|--------|----------|----------|----------|
| EXC_001 | 服务超时 | 服务容错性 | 优雅降级处理 |
| EXC_002 | 数据库连接失败 | 数据一致性 | 事务回滚 |
| EXC_003 | 库存服务异常 | 下单流程 | 订单失败，不扣库存 |
| EXC_004 | 支付服务异常 | 订单状态 | 订单状态保持一致 |

## 🚀 性能测试场景

### 6.1 并发测试
| 测试项 | 并发数 | 持续时间 | 成功标准 |
|--------|--------|----------|----------|
| 用户登录 | 100 TPS | 5分钟 | 响应时间 < 500ms |
| 商品查询 | 500 TPS | 10分钟 | 响应时间 < 300ms |
| 下单操作 | 50 TPS | 5分钟 | 响应时间 < 2s，无超卖 |
| 库存查询 | 200 TPS | 5分钟 | 响应时间 < 200ms |

### 6.2 压力测试
| 测试项 | 压力指标 | 监控项 | 阈值 |
|--------|----------|--------|------|
| 系统峰值 | 1000+ TPS | CPU、内存、数据库连接 | CPU < 80% |
| 数据量压力 | 10万+商品 | 查询性能 | 响应时间 < 1s |
| 长时间运行 | 24小时 | 内存泄漏 | 内存使用稳定 |

## 📊 测试数据详情

### 测试用户列表
```sql
-- 管理员
ID: 1, 用户名: admin, 密码: 123456

-- 普通用户 (ID: 2-12)
ID: 2, 用户名: zhangsan, 昵称: 张三
ID: 3, 用户名: lisi, 昵称: 李四
ID: 4, 用户名: wangwu, 昵称: 王五
...

-- VIP用户 (ID: 13-14)
ID: 13, 用户名: vip_liu, 昵称: VIP刘总
ID: 14, 用户名: vip_wang, 昵称: VIP王总
```

### 关键测试商品
```sql
-- 高价值商品（测试大额订单）
ID: 1, iPhone 15 Pro Max, 价格: ¥9,999, 库存: 156件
ID: 15, MacBook Pro, 价格: ¥31,067, 库存: 23件

-- 低库存商品（测试库存告警）
ID: 5, HUAWEI Mate 60 Pro, 库存: 5件
ID: 12, 小米14 Ultra, 库存: 8件

-- 零库存商品（测试售罄场景）
ID: 20, Redmi K70, 库存: 0件
```

### 订单状态分布
```sql
TRADE_FINISHED: 2个订单（已完成）
TRADE_SUCCESS: 4个订单（支付成功）
WAIT_BUYER_PAY: 2个订单（待支付）
PAYING: 1个订单（支付中）
TRADE_CLOSED: 1个订单（已关闭）
```

## 🎯 测试执行指南

### 环境准备
1. **数据库初始化**
```bash
# 完整初始化所有测试数据
mysql> source sql/init_all.sql;
```

2. **服务启动**
```bash
# 启动所有微服务
./start_all_services.sh
```

3. **验证环境**
```bash
# 运行集成测试验证
mysql> source sql/test_integration.sql;
```

### 测试执行顺序
1. **单元测试**: 各服务独立功能测试
2. **集成测试**: 跨服务协作测试
3. **性能测试**: 并发和压力测试
4. **异常测试**: 故障恢复测试

### 测试报告要点
- ✅ 功能完整性验证
- ✅ 数据一致性检查
- ✅ 性能指标达标
- ✅ 异常处理正确
- ✅ 用户体验良好

## 📈 测试指标和监控

### 关键业务指标
- **订单转化率**: 目标 > 60%
- **支付成功率**: 目标 > 95%
- **库存准确率**: 目标 = 100%
- **系统可用率**: 目标 > 99.9%

### 性能指标
- **平均响应时间**: < 1s
- **99%响应时间**: < 3s
- **系统吞吐量**: > 500 TPS
- **错误率**: < 0.1%

## 🔧 自动化测试

### 测试脚本位置
```
sql/
├── test_basic_queries.sql      # 基础功能测试
├── test_integration.sql        # 联动测试脚本
└── test_performance.sql        # 性能测试脚本（待开发）
```

### CI/CD 集成
```yaml
# 测试流水线示例
stages:
  - unit_test        # 单元测试
  - integration_test # 集成测试  
  - performance_test # 性能测试
  - deploy          # 部署
```

## 📞 问题反馈

在测试过程中如遇到问题，请：
1. 📋 检查测试数据是否正确初始化
2. 🔍 运行诊断脚本排查问题
3. 📝 记录详细的错误信息和复现步骤
4. 🚀 提交Issue到项目仓库

---

🎉 **开始测试吧！** 这份测试用例文档将帮助您全面验证 JoyShop 微服务系统的功能完整性和稳定性。